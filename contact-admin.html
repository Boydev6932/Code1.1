<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ติดต่อผู้ดูแลระบบ — KNW Check</title>

  <!-- CSP ที่อนุญาตให้โหลดรูปจาก file: ด้วย (ช่วยเวลาทดสอบแบบ file://) -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src 'self';
                 script-src 'self';
                 style-src 'self' 'unsafe-inline';
                 img-src 'self' https: data: blob: file:;
                 connect-src 'self';
                 font-src 'self';
                 object-src 'none';
                 base-uri 'none';
                 frame-ancestors 'none';
                 form-action 'self';">
  <meta name="referrer" content="strict-origin-when-cross-origin">

  <link rel="stylesheet" href="css/style.css">
</head>
<body class="contact">
  <div class="overlay contact-main">
    <div class="card contact-card" aria-labelledby="contact-heading">
      <div class="logos" aria-hidden="false">
        <img src="https://i0.wp.com/knw.ac.th/wp-content/uploads/2024/12/%E0%B9%81%E0%B8%81%E0%B9%88%E0%B8%99%E0%B8%99%E0%B8%84%E0%B8%A3%E0%B8%A7%E0%B8%B4%E0%B8%97%E0%B8%A2%E0%B8%B2%E0%B8%A5%E0%B8%B1%E0%B8%A2-Logo-PNG-color.png?resize=947%2C949&ssl=1"
             alt="โลโก้ แก่นนครวิทยาลัย" width="70" height="70" loading="lazy" decoding="async">
        <img src="https://scontent.fkkc3-1.fna.fbcdn.net/v/t1.15752-9/532944842_2000679387359224_5786569609575666025_n.png?stp=dst-png_p480x480&_nc_cat=109&ccb=1-7&_nc_sid=0024fc&_nc_ohc=v5YPLokYHLEQ7kNvwH1ja3F&_nc_oc=AdnlHs5L6L9gX79wuenMc_qbwDSBzWdgU2EJXS_4TewN5wr2nK9-vjRyuCKMms-yZbP39xSnqENHT5TB_Q3TH6fu&_nc_ad=z-m&_nc_cid=0&_nc_zt=23&_nc_ht=scontent.fkkc3-1.fna&oh=03_Q7cD3AFBevARtScDVGqIb7cflBSWmP2-ZeDEGIyCBi-HyAE_AA&oe=68D52AE7"
             alt="โลโก้ ROTC" width="60" height="80" loading="lazy" decoding="async">
      </div>

      <main class="container">
        <section>
          <h2 id="contact-heading" class="contact-heading">ช่องทางติดต่อผู้ดูแล</h2>

          <div class="card-actions" role="group" aria-label="เลือกแพลตฟอร์ม">
            <button class="btn btn-ghost active" data-show-qr="ig" aria-pressed="true">แสดง QR — Instagram</button>
            <button class="btn btn-ghost" data-show-qr="fb" aria-pressed="false">แสดง QR — Facebook</button>
            <button class="btn btn-ghost" data-show-qr="line" aria-pressed="false">แสดง QR — LINE</button>
          </div>

          <!-- QR display -->
          <div class="qr-display" aria-live="polite">
            <!-- qr-wrap แค่เป็นกล่องแสดงรูป -->
            <div id="qr-wrap" class="qr-wrap ig" aria-hidden="false">
              <img id="contact-qr-img"
                   class="qr-img"
                   src=""
                   alt="QR Code ของผู้ดูแล"
                   width="300" height="300"
                   loading="lazy" decoding="async">
            </div>

            <div class="qr-caption">สแกนเพื่อเริ่มแชท — <span id="qr-platform-label">Instagram</span></div>
            <div class="qr-hint-block muted-badge">สแกนด้วยกล้องมือถือเพื่อแอด/แชท</div>

            <div class="qr-extra">
              <div class="k">หากสแกนไม่ติด ให้พิมพ์ชื่อ IG : <strong>_littleboy555</strong></div>
              <div class="k">Facebook : <strong>Kungbang Konkaew</strong></div>
              <div class="k">Line Id : <strong>kungbang2435</strong></div>
            </div>

            <div id="qr-fallback" class="qr-fallback hidden" role="status" aria-hidden="true" style="margin-top:12px;">
              <div class="muted small" style="color:rgba(255,255,255,0.9); font-weight:700;">
                ไม่พบภาพ QR — กรุณาตรวจสอบไฟล์ที่ <code>./assets/qr-*.png</code>
              </div>
            </div>
          </div>
          <!-- /QR display -->

          <div class="contact-extra">
            <p class="muted small">มาแอบคุยกันเด้อ แอดเหงา</p>
            <ul class="contact-list">
              <li><strong>ผู้ดูแล:</strong> ทีมเทคนิค KNW Check</li>
              <li><strong>เวลาทำการ:</strong> จันทร์–ศุกร์ 08:30–21:30</li>
              <li><strong>หมายเหตุ:</strong> หากต้องการให้ทีมช่วยแก้ไขข้อมูล กรุณาแนบหลักฐานและติดต่อผ่านช่องทางด้านบน</li>
            </ul>
          </div>
        </section>

        <div class="contact-footer">
          <a class="back-home" href="./index.html"><span class="ico">←</span> ย้อนกลับหน้าหลัก</a>
        </div>
      </main>

      <footer class="site-footer">
        <small>© <span id="year"></span> KNW Check • ระบบติดต่อผู้ดูแล</small>
      </footer>
    </div>
  </div>

  <!-- Inline script: ตั้งปี, สลับ QR และลองโหลดภาพจากหลายพาธ/ชื่อ -->
<script>
(function(){
  // paths ที่จะลองหาไฟล์ (เรียงจาก priority สูง -> ต่ำ)
  const PATHS = [
    './assets/',
    'assets/',
    './public/assets/',
    'public/assets/',
    './',
    ''
  ];

  // ชื่อไฟล์ที่สคริปต์จะลอง (เพิ่มเผื่อตัวพิมพ์ใหญ่/underscore/.png.png/.jpg)
  const FILE_CANDIDATES = {
    ig:   ['qr-instagram.png','qr-instagram.PNG','qr_instagram.png','QR-Instagram.png','qr-instagram.png.png','qr-instagram.jpg'],
    fb:   ['qr-facebook.png','qr-facebook.PNG','qr_facebook.png','QR-Facebook.png','qr-facebook.png.png','qr-facebook.jpg'],
    line: ['qr-line.png','qr-line.PNG','qr_line.png','QR-Line.png','qr-line.png.png','qr-line.jpg']
  };

  const IMG = document.getElementById('contact-qr-img');
  const FBACK = document.getElementById('qr-fallback');
  const WRAP = document.getElementById('qr-wrap');
  const PLATFORM_LABEL = document.getElementById('qr-platform-label');

  // helper: แสดง/ซ่อน fallback
  function showFallback() {
    if (IMG) IMG.style.display = 'none';
    if (FBACK) FBACK.classList.remove('hidden');
  }
  function hideFallback() {
    if (FBACK) FBACK.classList.add('hidden');
    if (IMG) IMG.style.display = '';
  }

  // helper: ทดสอบ src โดยสร้าง Image() ชั่วคราว
  function testSrc(src) {
    return new Promise(resolve => {
      const tester = new Image();
      tester.onload = () => resolve({ok:true, src});
      tester.onerror = () => resolve({ok:false, src});
      tester.src = src;
    });
  }

  // ลองไล่หา src ที่ใช้ได้จริงทีละตัว (รันแบบ async)
  async function findWorkingSrc(platformKey) {
    const names = FILE_CANDIDATES[platformKey] || FILE_CANDIDATES.ig;
    const tries = [];
    PATHS.forEach(p => names.forEach(n => tries.push(p + n)));

    console.log('QR: trying', tries);
    for (const s of tries) {
      // testSrc จะคืน {ok:true,src} หรือ {ok:false,src}
      const res = await testSrc(s);
      if (res.ok) return res.src;
    }
    return null;
  }

  // ตั้งภาพตาม platform (ig|fb|line)
  async function setPlatform(key) {
    // toggle ปุ่ม active
    document.querySelectorAll('[data-show-qr]').forEach(btn => {
      const active = btn.dataset.showQr === key;
      btn.classList.toggle('active', active);
      btn.setAttribute('aria-pressed', active ? 'true' : 'false');
    });

    if (PLATFORM_LABEL) PLATFORM_LABEL.textContent = key === 'ig' ? 'Instagram' : key === 'fb' ? 'Facebook' : 'LINE';
    if (WRAP) WRAP.className = 'qr-wrap ' + (key === 'ig' ? 'ig' : key === 'fb' ? 'fb' : 'line');

    hideFallback();

    // หาไฟล์ที่เจอจริง
    const src = await findWorkingSrc(key);
    if (src) {
      console.log('QR: found', src);
      IMG.src = src;
      IMG.alt = 'QR Code ของผู้ดูแล (' + PLATFORM_LABEL.textContent + ')';
      IMG.style.display = ''; // แสดงภาพ
      if (FBACK) FBACK.classList.add('hidden');
    } else {
      console.warn('QR: no image found for', key);
      showFallback();
    }
  }

  // bind ปุ่มสลับ
  document.querySelectorAll('[data-show-qr]').forEach(btn => {
    btn.addEventListener('click', () => setPlatform(btn.dataset.showQr));
  });

  // โหลดเริ่มต้น
  setPlatform('ig');

  // debug: ให้สามารถเรียกจาก console ได้
  window._knw_setQR = setPlatform;
})();
</script>